<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Java集合之ArrayList' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Java集合之ArrayList</center></div><div class='banquan'>原文出处:本文由博客园博主灰马非马提供。<br/>
原文连接:https://www.cnblogs.com/yanghanwen/p/11992655.html</div><br>
    <p>一、基础</p>
<p>　　ArrayList不是线程安全的，多线程建议使用Vector或者CopyOnWriteArrayList;</p>
<p>　　底层实现是Object数组。默认容量<span style="color: #660e7a;"><strong><em>DEFAULT_CAPACITY</em></strong></span>为10，最大数组大小MAX_ARRAY_SIZE为Integer.MAX_VALUE-8;</p>
<p>　　实现了RandomAccess接口，表明可以快速随机访问;</p>
<p>　　实现了Cloneable接口，表明能被克隆;</p>
<p>　　实现了Serializabble接口，表明能序列化之后传输;</p>
<p>二、源码方法</p>
<p>　　构造函数：</p>
<p>　　无参构造函数ArrayList（），构造一个<span class="tlid-translation translation" lang="zh-CN"><span title="">用于空实例的共享空数组实例</span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title="">　　一个int类型参数的构造函数 ArrayList（int initialCapacity）构造一个具有指定初始容量的空列表</span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title="">　　一个指定collection的构造函数ArrayList（Collection&lt;？ extends E&gt; c）构造一个包含指定collection的元素的列表，这些元素是按照该collection的迭代器返回它们的顺序排列的</span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title="">　　方法：</span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title="">　　size()：返回数组大小</span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title="">　　isEmpty()：返回数组是否为空</span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title="">　　contains(Object o)：返回是否包含某对象</span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title="">　　clear()：<span class="tlid-translation translation" lang="zh-CN"><span title="">从此列表中删除所有元素，<span title="">并且将siz置为0</span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span title="">　　<span class="tlid-translation translation" lang="zh-CN"><span title="">ensureCapacity(int minCapacity)：将数组容量扩容至指定大小</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title="">　　<span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span title="">addAll(Collection&lt;? extends E&gt; c)：将指定集合的<span class="tlid-translation translation" lang="zh-CN"><span title="">所有元素追加到<span title="">list末尾</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span title="">　　<span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span title="">removeAll(Collection&lt;?&gt; c)：<span class="tlid-translation translation" lang="zh-CN"><span title="">从此列表中删除包含在其中的所有元素<span title="">指定的集合</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title="">　　indexOf(Object o)：如果包含则<span class="tlid-translation translation" lang="zh-CN"><span title="">返回指定元素首次出现的索引</span></span>，不包含则返回-1</span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title="">　　lastIndexOf(Object o)：<span class="tlid-translation translation" lang="zh-CN"><span title="">如果包含则<span class="tlid-translation translation" lang="zh-CN"><span title="">返回指定元素最后出现的索引，不包含则返回-1</span></span></span></span></span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title="">　　<span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span title="">removeRange(int fromIndex, int toIndex)：<span class="tlid-translation translation" lang="zh-CN"><span title="">从该列表中删除索引在之间的所有元素</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title="">　　<span class="tlid-translation translation" lang="zh-CN"><span title="">trimToSize()：将elementData的数组设置为ArrayList实际的容量，<span class="tlid-translation translation" lang="zh-CN"><span title="">删除动态增长的多余容量</span></span></span></span></span></span></span></span></span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title="">　　remove(Object o)：<span class="tlid-translation translation" lang="zh-CN"><span title="">从此列表中删除第一次出现的指定元素，删除成功返回true，否正返回false</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span title="">　　addAll(int index, Collection&lt;? extends E&gt; c)：<span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span title="">从指定位置开始，</span></span></span></span></span></span></span></span></span></span></span></span><span class="tlid-translation translation" lang="zh-CN"><span title="">将指定集合中的所有元素插入到此<span title="">列表</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span title="">　　<span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span title="">retainAll(Collection&lt;?&gt; c)：<span class="tlid-translation translation" lang="zh-CN"><span title="">仅保留此列表中包含在<span title="">指定的集合的元素， <span title="">换句话说，从此列表中删除所有<span title="">未包含在指定集合中的元素</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title="">　　<span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title=""><span class="tlid-translation translation" lang="zh-CN"><span title="">get(int index)、set(int index, E element)、add(E e)、add(int index, E element)、remove(int index)、</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>三、扩容</p>
<p>　　ArrayList初始大小为0，在添加第一个元素的时候，调用add方法，进入add方法时，需要先确定容量足以放下这个元素</p>
<p style="margin-left: 30px;"><img src="./images/Java集合之ArrayList0.png" alt="" /></p>
<p>　　进入ensureCapacityInternal()方法，传入值为（当前size+1），然后判断当前数组是否为默认的空数组，满足条件，则最小扩容需要值为（当前size+1）和默认容量中较大的一个值。不是默认的空数组，则最小扩容需要值为（当前size+1）大小</p>
<p style="margin-left: 30px;"><img src="./images/Java集合之ArrayList1.png" alt="" /></p>
<p>　　然后进入<span style="color: #000000;">ensureExplicitCapacity()</span>方法，传入最小扩容需要值，然后判断最小扩容需要值和当前对象数组的长度，如果最小扩容需要值大于当前的数组长度，则调用grow()方法进行扩容</p>
<p style="margin-left: 30px;"><img src="./images/Java集合之ArrayList2.png" alt="" /></p>
<p>　　扩容时，暂定扩容值大小为原大小+原大小右移一位（偶数的1.5倍，奇数-1的1.5倍），记为newCapacity，然后判断暂定扩容值和最小容量需要值，扩容值两者中较大值。然后再比较扩容值和数组容量最大值，如果超过了数组容量最大值，再进入hugeCapacity()进入特殊处理。</p>
<p style="margin-left: 30px;"><img src="./images/Java集合之ArrayList3.png" alt="" /></p>
<p>　　hugeCapacity()方法中，先判断最小扩容需要值是否为负数，是的话，则抛出内存溢出错误。否则判断最小扩容需要值和Integer的最大值-8比较，再确定最终的扩容值，减去的8位存放的是数组的长度</p>
<p style="margin-left: 30px;"><img src="./images/Java集合之ArrayList4.png" alt="" /></p>
<p>　　确定了扩容值之后，就进行扩容操作，根据扩容值新建数组，然后拷贝数组，数组拷贝时调用的是本地方法 System.arraycopy() ，在C语言方法中调用frenn()释放了原数组。</p>
<p>总结：</p>
<p>　　自动扩容不易，在新建ArrayList时，可以指定大小，或者在新增大量元素之前，可以调用ensureCapacity(int minCapacity)方法先手动扩容</p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>