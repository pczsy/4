<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修1.2异常处理和服务配置、aop、日志、自定义事件处理' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>1.2异常处理和服务配置、aop、日志、自定义事件处理</center></div><div class='banquan'>原文出处:本文由博客园博主wm根mw提供。<br/>
原文连接:https://www.cnblogs.com/sovy/p/11527237.html</div><br>
    <p><span style="color: #800000; font-size: 18pt;"><strong>一、异常处理</strong></span></p>
<p><strong>2.1、数据验证</strong></p>
<p>现在假设说要进行表单信息提交，肯定需要有一个表单，而后这个表单要将数据提交到 VO 类中，所以现在的基本实现如下：</p>
<p>1、 建立一个 Member.java 的 VO 类：</p>
<src class="cnblogs_code">
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>
<pre><code>package cn.study.microboot.vo;

import java.io.Serializable;
import java.util.Date;

@SuppressWarnings("serial")
public class Member implements Serializable {
    private String mid ;
    private Integer age ;
    private Double salary ;
    private Date birthday ;
    public String getMid() {
        return mid;
    }
    public void setMid(String mid) {
        this.mid = mid;
    }
    public Integer getAge() {
        return age;
    }
    public void setAge(Integer age) {
        this.age = age;
    }
    public Double getSalary() {
        return salary;
    }
    public void setSalary(Double salary) {
        this.salary = salary;
    }
    public Date getBirthday() {
        return birthday;
    }
    public void setBirthday(Date birthday) {
        this.birthday = birthday;
    }
    @Override
    public String toString() {
        return "Member [mid=" + mid + ", age=" + age + ", salary=" + salary
                + ", birthday=" + birthday + "]";
    }
}</code></pre>
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>

<p>2、 由于此时的程序之中需要进行日期的转换处理操作，那么就需要为其做一个转换处理的格式配置，修改 AbstractBaseController 类，追加如下的转换操作方法绑定：</p>
<src class="cnblogs_code">
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>
<pre><code>@InitBinder
    public void initBinder(WebDataBinder binder) {    // 在本程序里面需要针对于日期格式进行处理
        // 首先建立一个可以将字符串转换为日期的工具程序类
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd") ;
        // 明确的描述此时需要注册一个日期格式的转化处理程序类
        binder.registerCustomEditor(java.util.Date.class, new CustomDateEditor(sdf, true));
    }</code></pre>
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>

<p>3、 建立一个 MemberController 程序类，负责实现 Member 的控制层处理操作。</p>
<src class="cnblogs_code">
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>
<pre><code>package cn.study.microboot.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;

import cn.study.microboot.util.controller.AbstractBaseController;
import cn.study.microboot.vo.Member;

@Controller
public class MemberController extends AbstractBaseController {
    @RequestMapping(value = "/addPre", method = RequestMethod.GET)
    public String addPre() {    // 增加前的准备操作路径
        return "member_add" ; 
    }
    @RequestMapping(value = "/add", method = RequestMethod.POST)
    @ResponseBody
    public Object add(Member vo) {    // 增加前的准备操作路径
        return vo ; 
    }
}</code></pre>
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>

<p>4、 编写一个页面进行用户的表单填写（在 src/main/view/templates 下建立）：member_add.html；</p>
<src class="cnblogs_code">
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>
<pre><code>&lt;!DOCTYPE HTML&gt;
&lt;html xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
    &lt;title&gt;SpringBoot模版渲染&lt;/title&gt;
    &lt;link rel="icon" type="image/x-icon" href="/images/study.ico"/&gt;
    &lt;meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action="add" method="post"&gt;
        用户邮箱：&lt;input type="text" name="mid" value="studyjava@163.com"/&gt;&lt;br/&gt;
        用户年龄：&lt;input type="text" name="age" value="18"/&gt;&lt;br/&gt;
        用户工资：&lt;input type="text" name="salary" value="1000"/&gt;&lt;br/&gt;
        用户生日：&lt;input type="text" name="birthday" value="2010-10-10"/&gt;&lt;br/&gt;
        &lt;input type="submit" value="提交"/&gt;
        &lt;input type="reset" value="重置"/&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>

<p>5、 此时的代码只是一个最为普通的处理操作，但是这个时候对于该程序也是存在有如下问题的：</p>
<p>&middot; 如果某些数据没有输入，则内容是 null，如果要进行严格控制，这些 null 不应该存在；</p>
<p>&middot; 某些数据需要进行格式验证，例如：用户名应该是邮箱，这个的信息应该进行邮箱验证；</p>
<p>所以现在如果要想进行这些的验证，SpringBoot 里面有默认的支持，只不过这种支持未必是最好的，在 SpringBoot 里面为了 方便用户编写验证专门提供有一个 hibernate-validation.jar 工具包，这个工具包是由 hibernate 开发框架提供的。</p>
<p><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理8.png" alt="" /></p>
<p>6、 如果要想进行验证，那么首先要解决的问题就必须是错误的提示信息问题，而在 SpringBoot 里面对于错误信息的保存，都要 求其保存在 ValidationMessages.properties 文件，在&ldquo;src/main/resources&rdquo;目录中建立此文件；</p>
<src class="cnblogs_code">
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>
<pre><code>member.mid.notnull.error=用户名不允许为空！
member.mid.email.error=用户名的注册必须输入正确的邮箱！
member.mid.length.error=用户名的格式错误！
member.age.notnull.error=年龄不允许为空
member.age.digits.error=年龄必须是合法数字！
member.salary.notnull.error=工资不允许为空！
member.salary.digits.error=工资必须是合法数字！
member.birthday.notnull.error=生日不允许为空！</code></pre>
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>

<p><strong>&nbsp;提示：</strong>你一个表单就需要编写这么多的配置项，那么如果要有几百个表单呢？这样的配置项太可怕了，所以最好的数据检测还是利 用拦截器处理最合适。</p>
<p>&nbsp;7、 修改 Member.java 程序类追加验证的处理方式：</p>
<src class="cnblogs_code">
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>
<pre><code>package cn.study.microboot.vo;

import java.io.Serializable;
import java.util.Date;

import javax.validation.constraints.Digits;
import javax.validation.constraints.NotNull;

import org.hibernate.validator.constraints.Email;
import org.hibernate.validator.constraints.Length;


@SuppressWarnings("serial")
public class Member implements Serializable {
    @NotNull(message="{member.mid.notnull.error}")
    @Email(message="{member.mid.email.error}")
    @Length(min=6,message="{member.mid.length.error}")
    private String mid ;
    @NotNull(message="{member.age.notnull.error}")
    @Digits(integer=3,fraction=0,message="{member.age.digits.error}")
    private Integer age ;
    @NotNull(message="{member.salary.notnull.error}")
    @Digits(integer=20,fraction=2,message="{member.salary.digits.error}")
    private Double salary ;
    @NotNull(message="{member.birthday.notnull.error}")
    private Date birthday ;
    public String getMid() {
        return mid;
    }
    public void setMid(String mid) {
        this.mid = mid;
    }
    public Integer getAge() {
        return age;
    }
    public void setAge(Integer age) {
        this.age = age;
    }
    public Double getSalary() {
        return salary;
    }
    public void setSalary(Double salary) {
        this.salary = salary;
    }
    public Date getBirthday() {
        return birthday;
    }
    public void setBirthday(Date birthday) {
        this.birthday = birthday;
    }
    @Override
    public String toString() {
        return "Member [mid=" + mid + ", age=" + age + ", salary=" + salary
                + ", birthday=" + birthday + "]";
    }
}</code></pre>
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>

<p>&nbsp;8、 修改 MemberController 类中的 add()方法来观察错误信息的显示：</p>
<src class="cnblogs_code">
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>
<pre><code>package cn.study.microboot.controller;

import java.util.Iterator;

import javax.validation.Valid;

import org.springframework.stereotype.Controller;
import org.springframework.validation.BindingResult;
import org.springframework.validation.ObjectError;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;

import cn.study.microboot.util.controller.AbstractBaseController;
import cn.study.microboot.vo.Member;

@Controller
public class MemberController extends AbstractBaseController {
    @RequestMapping(value = "/add", method = RequestMethod.POST)
    @ResponseBody
    public Object add(@Valid Member vo, BindingResult result) { // 增加前的准备操作路径
        if (result.hasErrors()) { // 现在表示执行的验证出现错误
            Iterator&lt;ObjectError&gt; iterator = result.getAllErrors().iterator(); // 获取全部错误信息
            while (iterator.hasNext()) {
                ObjectError error = iterator.next() ;    // 取出每一个错误
                System.out.println("【错误信息】code = " + error.getCode() + "，message = " + error.getDefaultMessage());
            }
            return result.getAllErrors() ;
        } else {
            return vo;
        }
    }
    @RequestMapping(value = "/addPre", method = RequestMethod.GET)
    public String addPre() { // 增加前的准备操作路径
        return "member_add";
    }
}</code></pre>
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>

<p>&nbsp;对于此类的验证大家理解即可，不需要将其作为重点，但是需要清楚，默认情况下 SpringBoot 提供的数据验证需要通过注解 以及一系列的资源文件进行定义后才可以使用，而且所有的错误都必须用户自己来处理，这一点的设计不如直接编写具体的反射拦 截器方便。</p>
<p><strong>2.2、处理错误页</strong></p>
<p>错误页绝对是所有的 WEB 项目之中必须具有的一项信息显示处理，但是在传统的 WEB 项目开发过程之中，错误页都是在 web.xml 文件之中进行配置的，不过遗憾的是 SpringBoot 之中并不存在有 web.xml 配置文件这一项，那么如果要想进行错误页的处 理，最好的做法是需要根据每一个错误代码创建一个属于自己的错误显示页。</p>
<p>&nbsp;1、 所有的错误页都是普通的静态文件，那么建议在&ldquo;src/main/view/static&rdquo;目录下创建几个常见的错误页（常见的错误的 HTTP 返回编码：404、500、400）</p>
<p><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理15.png" alt="" /></p>
<p>2、 添加一个错误页的配置类，在启动类中编写一个错误页的配置项；</p>
<src class="cnblogs_code">
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>
<pre><code>package cn.study.microboot.config;

import org.springframework.boot.context.embedded.ConfigurableEmbeddedServletContainer;
import org.springframework.boot.context.embedded.EmbeddedServletContainerCustomizer;
import org.springframework.boot.web.servlet.ErrorPage;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpStatus;

@Configuration
public class ErrorPageConfig {
    @Bean
    public EmbeddedServletContainerCustomizer containerCustomizer() {
        return new EmbeddedServletContainerCustomizer() {
            @Override
            public void customize(
                    ConfigurableEmbeddedServletContainer container) {
                ErrorPage errorPage400 = new ErrorPage(HttpStatus.BAD_REQUEST,
                        "/error-400.html");
                ErrorPage errorPage404 = new ErrorPage(HttpStatus.NOT_FOUND,
                        "/error-404.html");
                ErrorPage errorPage500 = new ErrorPage(
                        HttpStatus.INTERNAL_SERVER_ERROR, "/error-500.html");
                container.addErrorPages(errorPage400, errorPage404,
                        errorPage500);
            }
        };
    }
}</code></pre>
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>

<p>&nbsp;那么此时只要出现了错误，就会找到相应的 http 状态码，而后跳转到指定的错误路径上进行显示。</p>
<p><strong>&nbsp;2.3、全局异常</strong></p>
<p>&nbsp;下面首先来观察一个程序代码，例如：现在建立一个控制器，而后这个控制器自己抛出一个异常。</p>
<src class="cnblogs_code">
<pre><code>@RequestMapping(value="/get")
    @ResponseBody
    public String get() {
        System.out.println("除法计算：" + (10 / 0));
        return "hello world" ;
    }</code></pre>

<p>&nbsp;如果此时配置有错误页，那么这个时候错误会统一跳转到 500 所在的路径上进行错误的显示，但是如果说现在希望能够显示 出错误更加详细的内容呢？</p>
<p>&nbsp;所以这个时候可以单独定义一个页面进行错误的信息显示处理，而这个页面，可以定义在&ldquo;src/main/view/templates/error.html&rdquo;， 这个页面里面要求可以输出一些信息；</p>
<p>&nbsp;1、 定义一个全局的异常处理类：</p>
<src class="cnblogs_code">
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>
<pre><code>import javax.servlet.http.HttpServletRequest;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.servlet.ModelAndView;

@ControllerAdvice // 作为一个控制层的切面处理
public class GlobalExceptionHandler {
    public static final String DEFAULT_ERROR_VIEW = "error"; // 定义错误显示页，error.html

    @ExceptionHandler(Exception.class) // 所有的异常都是Exception子类
    public ModelAndView defaultErrorHandler(HttpServletRequest request, Exception e) { // 出现异常之后会跳转到此方法
        ModelAndView mav = new ModelAndView(DEFAULT_ERROR_VIEW); // 设置跳转路径
        mav.addObject("exception", e); // 将异常对象传递过去
        mav.addObject("url", request.getRequestURL()); // 获得请求的路径
        return mav;
    }
}</code></pre>
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>

<p>&nbsp;</p>
<p>&nbsp;2、 定义 error.html 页面：</p>
<src class="cnblogs_code">
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>
<pre><code>&lt;!DOCTYPE HTML&gt;
&lt;html xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
&lt;title&gt;SpringBoot模版渲染&lt;/title&gt;
&lt;link rel="icon" type="image/x-icon" href="/images/study.ico"/&gt;
&lt;meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p th:text="${url}"/&gt;
&lt;p th:text="${exception.message}"/&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>

<p>&nbsp;</p>
<p>&nbsp;对于全局异常信息显示除了采用以上的跳转处理方式之外，也可以做的简单一些，使用 Rest 进行显示。</p>
<p>范例：修改全局异常处理类</p>
<src class="cnblogs_code">
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>
<pre><code>package cn.study.microboot.advice;

import javax.servlet.http.HttpServletRequest;

import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;

//@ControllerAdvice// 作为一个控制层的切面处理
@RestControllerAdvice
public class GlobalExceptionHandler {
    public static final String DEFAULT_ERROR_VIEW = "error"; // 定义错误显示页，error.html
    @ExceptionHandler(Exception.class) // 所有的异常都是Exception子类
    public Object defaultErrorHandler(HttpServletRequest request,Exception e) {
        class ErrorInfo {
            private Integer code ;
            private String message ;
            private String url ;
            public Integer getCode() {
                return code;
            }
            public void setCode(Integer code) {
                this.code = code;
            }
            public String getMessage() {
                return message;
            }
            public void setMessage(String message) {
                this.message = message;
            }
            public String getUrl() {
                return url;
            }
            public void setUrl(String url) {
                this.url = url;
            }
        }
        ErrorInfo info = new ErrorInfo() ;
        info.setCode(100);     // 标记一个错误信息类型
        info.setMessage(e.getMessage());
        info.setUrl(request.getRequestURL().toString());
        return info ;
    }
//    public ModelAndView defaultErrorHandler(HttpServletRequest request,
//            Exception e) { // 出现异常之后会跳转到此方法
//        ModelAndView mav = new ModelAndView(DEFAULT_ERROR_VIEW); // 设置跳转路径
//        mav.addObject("exception", e); // 将异常对象传递过去
//        mav.addObject("url", request.getRequestURL()); // 获得请求的路径
//        return mav;
//    }
}</code></pre>
<src class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./images/1.2异常处理和服务配置、aop、日志、自定义事件处理0.png" alt="复制代码" /></a></span>

<p>&nbsp;</p>
<p><span style="color: #800000; font-size: 18pt;">二、服务配置</span></p>
<p>&nbsp;Spring Boot 其默认是集成web容器的，启动方式由像普通Java程序一样，main函数入口启动。其内置Tomcat容器或Jetty容器，具体由配置来决定（默认Tomcat）。当然你也可以将项目打包成war包，放到独立的web容器中（Tomcat、weblogic等等），当然在此之前你要对程序入口做简单调整。</p>
<h3 id="一内嵌-server-配置">一、内嵌 Server 配置</h3>
<p>Spring Boot将容器内置后，它通过配置文件的方式类修改相关server配置。</p>
<p>其中常用的配置只有少数几个，已经用紫色标记起来。红框圈起来的部分，看名称分类就可以明白其作用。<br />对server的几个常用的配置做个简单说明：</p>
<pre name="code" class="prettyprint"><code class="hljs vala has-numbering shell"><span class="hljs-preprocessor"><span class="hljs-meta">#<span class="bash"> 项目contextPath，一般在正式发布版本中，我们不配置
server.context-path=/myspringboot<br />
<span class="hljs-preprocessor"><span class="hljs-meta">#<span class="bash"> 错误页，指定发生错误时，跳转的URL。请查看BasicErrorController源码便知<br />
server.error.path=/error<br />
<span class="hljs-preprocessor"><span class="hljs-meta">#<span class="bash"> 服务端口<br />
server.port=<span class="hljs-number">9090<br />
<span class="hljs-preprocessor"><span class="hljs-meta">#<span class="bash"> session最大超时时间(分钟)，默认为30<br />
server.session-timeout=<span class="hljs-number">60<br />
<span class="hljs-preprocessor"><span class="hljs-meta">#<span class="bash"> 该服务绑定IP地址，启动服务器时如本机不是该IP地址则抛出异常启动失败，只有特殊需求的情况下才配置
<span class="hljs-preprocessor"><span class="hljs-meta">#<span class="bash"> server.address=192.168.16.11</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p><strong>Tomcat</strong><br />Tomcat为Spring Boot的默认容器，下面是几个常用配置：</p>
<pre name="code" class="prettyprint"><code class="hljs ruby has-numbering"><span class="hljs-comment"># tomcat最大线程数，默认为200<br />
server.tomcat.max-threads=<span class="hljs-number">800<br />
<span class="hljs-comment"># tomcat的URI编码<br />
server.tomcat.uri-encoding=<span class="hljs-constant">UTF-<span class="hljs-number">8<br />
<span class="hljs-comment"># 存放Tomcat的日志、Dump等文件的临时文件夹，默认为系统的tmp文件夹（如：C:\Users\Shanhy\AppData\Local\Temp）<br />
server.tomcat.basedir=<span class="hljs-constant"><span class="hljs-symbol">H<span class="hljs-symbol"><span class="hljs-symbol">:/springboot-tomcat-tmp<br />
<span class="hljs-comment"># 打开Tomcat的Access日志，并可以设置日志格式的方法：<br />
<span class="hljs-comment">#server.tomcat.access-log-enabled=true<br />
<span class="hljs-comment">#server.tomcat.access-log-pattern=<br />
<span class="hljs-comment"># accesslog目录，默认在basedir/logs<br />
<span class="hljs-comment">#server.tomcat.accesslog.directory=<br />
<span class="hljs-comment"># 日志文件目录<br />
logging.path=<span class="hljs-constant"><span class="hljs-symbol">H<span class="hljs-symbol"><span class="hljs-symbol">:/springboot-tomcat-tmp<br />
<span class="hljs-comment"># 日志文件名称，默认为spring.log
logging.file=myapp.log</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p><strong>Jetty</strong><br />如果你要选择Jetty，也非常简单，就是把pom中的tomcat依赖排除，并加入Jetty容器的依赖，如下：</p>
<pre name="code" class="prettyprint"><code class="hljs xml has-numbering"><span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">dependencies<span class="hljs-tag">&gt;<br />
  <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">dependency<span class="hljs-tag">&gt;<br />
    <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">groupId<span class="hljs-tag">&gt;org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">groupId<span class="hljs-tag">&gt;<br />
    <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">artifactId<span class="hljs-tag">&gt;spring-boot-starter-web<span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">artifactId<span class="hljs-tag">&gt;<br />
    <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">exclusions<span class="hljs-tag">&gt;<br />
      <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">exclusion<span class="hljs-tag">&gt;<br />
        <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">groupId<span class="hljs-tag">&gt;org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">groupId<span class="hljs-tag">&gt;<br />
        <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">artifactId<span class="hljs-tag">&gt;spring-boot-starter-tomcat<span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">artifactId<span class="hljs-tag">&gt;<br />
      <span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">exclusion<span class="hljs-tag">&gt;<br />
    <span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">exclusions<span class="hljs-tag">&gt;<br />
  <span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">dependency<span class="hljs-tag">&gt;<br />
  <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">dependency<span class="hljs-tag">&gt;<br />
    <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">groupId<span class="hljs-tag">&gt;org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">groupId<span class="hljs-tag">&gt;<br />
    <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">artifactId<span class="hljs-tag">&gt;spring-boot-starter-jetty<span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">artifactId<span class="hljs-tag">&gt;<br />
  <span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">dependency<span class="hljs-tag">&gt;<br />
<span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">dependencies<span class="hljs-tag">&gt; </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p><strong>打包</strong><br />打包方法：<br />CMD进入项目目录，使用 mvn clean package 命令打包，以我的项目工程为例：</p>
<pre name="code" class="prettyprint"><code class="hljs lasso has-numbering groovy"><span class="hljs-string">D:<span class="hljs-subst">\spring<span class="hljs-attribute">-boot<span class="hljs-attribute">-sample<span class="hljs-subst">&gt;mvn clean <span class="hljs-keyword">package</span></span></span></span></span></span></code></code></pre>
<p>可以追加参数 -Dmaven.test.skip=true 跳过测试。<br />打包后的文件存放于项目下的target目录中，如：spring-boot-sample-0.0.1-SNAPSHOT.jar<br />如果pom配置的是war包，则为spring-boot-sample-0.0.1-SNAPSHOT.war</p>
<h3 id="二部署到javaee容器">二、部署到JavaEE容器</h3>
<ol>
<li>修改启动类，继承 SpringBootServletInitializer 并重写 configure 方法</li>
</ol>
<pre name="code" class="prettyprint"><code class="hljs java has-numbering"><span class="hljs-keyword">public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class<span class="hljs-class"> <span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpringBootSampleApplication<span class="hljs-class"> <span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends<span class="hljs-class"> <span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpringBootServletInitializer{<br /><br />

    <span class="hljs-keyword">private <span class="hljs-keyword">static <span class="hljs-keyword">final Logger logger = LoggerFactory.getLogger(SpringBootSampleApplication.class);<br /><br />

    <span class="hljs-annotation"><span class="hljs-meta">@Override
    <span class="hljs-keyword">protected<span class="hljs-function"> SpringApplicationBuilder <span class="hljs-title">configure<span class="hljs-function"><span class="hljs-params">(SpringApplicationBuilder builder) {<br />
        <span class="hljs-keyword">return builder.sources(<span class="hljs-keyword">this.getClass());<br />
    }<br /><br />

}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<ol>
<li>修改pom文件中jar 为 war</li>
</ol>
<pre name="code" class="prettyprint"><code class="hljs xml has-numbering"><span class="hljs-comment">&lt;!-- &lt;packaging&gt;jar&lt;/packaging&gt; --&gt;
<span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">packaging<span class="hljs-tag">&gt;war<span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">packaging<span class="hljs-tag">&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<ol>
<li>修改pom，排除tomcat插件</li>
</ol>
<pre name="code" class="prettyprint"><code class="hljs xml has-numbering">        <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">dependency<span class="hljs-tag">&gt;<br />
            <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">groupId<span class="hljs-tag">&gt;org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">groupId<span class="hljs-tag">&gt;<br />
            <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">artifactId<span class="hljs-tag">&gt;spring-boot-starter-web<span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">artifactId<span class="hljs-tag">&gt;<br />
            <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">exclusions<span class="hljs-tag">&gt;<br />
                <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">exclusion<span class="hljs-tag">&gt;<br />
                    <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">groupId<span class="hljs-tag">&gt;org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">groupId<span class="hljs-tag">&gt;<br />
                    <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">artifactId<span class="hljs-tag">&gt;spring-boot-starter-tomcat<span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">artifactId<span class="hljs-tag">&gt;<br />
                <span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">exclusion<span class="hljs-tag">&gt;<br />
            <span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">exclusions<span class="hljs-tag">&gt;<br />
        <span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">dependency<span class="hljs-tag">&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<ol>
<li>打包部署到容器<br />使用命令 mvn clean package 打包后，同一般J2EE项目一样部署到web容器。</li>

</ol>
<h3 id="三使用profile区分环境">三、使用Profile区分环境</h3>
<p>spring boot 可以在 &ldquo;配置文件&rdquo;、&ldquo;Java代码类&rdquo;、&ldquo;日志配置&rdquo; 中来配置profile区分不同环境执行不同的结果</p>
<p>1、配置文件<br />使用配置文件application.yml 和 application.properties 有所区别<br />以application.properties 为例，通过文件名来区分环境 application-{profile}.properties<br />application.properties</p>
<pre name="code" class="prettyprint"><code class="hljs avrasm has-numbering delphi">app<span class="hljs-preprocessor">.<span class="hljs-keyword">name=MyApp
server<span class="hljs-preprocessor">.port=<span class="hljs-number">8080
spring<span class="hljs-preprocessor">.profiles<span class="hljs-preprocessor">.active=dev</span></span></span></span></span></span></code></code></pre>
<p>application-dev.properties</p>
<p>&nbsp;</p>
<pre name="code" class="prettyprint"><code class="hljs fix has-numbering vbscript"><span class="hljs-attribute"><span class="hljs-built_in">server.port=<span class="hljs-string">8081</span></span></span></code></code></pre>
<p>application-stg.properties</p>
<p>&nbsp;</p>
<pre name="code" class="prettyprint"><code class="hljs fix has-numbering vbscript"><span class="hljs-attribute"><span class="hljs-built_in">server.port=<span class="hljs-string">8082</span></span></span></code></code></pre>
<p>在启动程序的时候通过添加 &ndash;spring.profiles.active={profile} 来指定具体使用的配置<br />例如我们执行 java -jar demo.jar &ndash;spring.profiles.active=dev 那么上面3个文件中的内容将被如何应用？<br />Spring Boot 会先加载默认的配置文件，然后使用具体指定的profile中的配置去覆盖默认配置。</p>
<blockquote>
<p>app.name 只存在于默认配置文件 application.properties 中，因为指定环境中不存在同样的配置，所以该值不会被覆盖<br />server.port 默认为8080，但是我们指定了环境后，将会被覆盖。如果指定stg环境，server.port 则为 8082<br />spring.profiles.active 默认指定dev环境，如果我们在运行时指定 &ndash;spring.profiles.active=stg 那么将应用stg环境，最终 server.port 的值为8082</p>

</blockquote>
<p>2、Java类中@Profile注解<br />下面2个不同的类实现了同一个接口，@Profile注解指定了具体环境</p>
<pre name="code" class="prettyprint"><code class="hljs java has-numbering"><span class="hljs-comment">// 接口定义<br />
<span class="hljs-keyword">public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface<span class="hljs-class"> <span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SendMessage<span class="hljs-class"> {<br />

    <span class="hljs-comment">// 发送短信方法定义<br />
    <span class="hljs-keyword">public<span class="hljs-function"> <span class="hljs-keyword">void<span class="hljs-function"> <span class="hljs-title">send<span class="hljs-function">();<br />

}<br />
<br />
<span class="hljs-comment">// Dev 环境实现类<br />
<span class="hljs-annotation"><span class="hljs-meta">@Component<br />
<span class="hljs-annotation"><span class="hljs-meta">@Profile(<span class="hljs-string">"dev")<br />
<span class="hljs-keyword">public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class<span class="hljs-class"> <span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DevSendMessage<span class="hljs-class"> <span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements<span class="hljs-class"> <span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SendMessage<span class="hljs-class"> {<br />

    <span class="hljs-annotation"><span class="hljs-meta">@Override<br />
    <span class="hljs-keyword">public<span class="hljs-function"> <span class="hljs-keyword">void<span class="hljs-function"> <span class="hljs-title">send<span class="hljs-function"><span class="hljs-params">() {<br />
        System.out.println(<span class="hljs-string">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;Dev Send()&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;");<br />
    }<br />

}<br />

<span class="hljs-comment">// Stg环境实现类<br />
<span class="hljs-annotation"><span class="hljs-meta">@Component<br />
<span class="hljs-annotation"><span class="hljs-meta">@Profile(<span class="hljs-string">"stg")<br />
<span class="hljs-keyword">public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class<span class="hljs-class"> <span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StgSendMessage<span class="hljs-class"> <span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements<span class="hljs-class"> <span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SendMessage<span class="hljs-class"> {

    <span class="hljs-annotation"><span class="hljs-meta">@Override<br />
    <span class="hljs-keyword">public<span class="hljs-function"> <span class="hljs-keyword">void<span class="hljs-function"> <span class="hljs-title">send<span class="hljs-function"><span class="hljs-params">() {<br />
        System.out.println(<span class="hljs-string">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;Stg Send()&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;");<br />
    }<br />

}<br />

<span class="hljs-comment">// 启动类<br />
<span class="hljs-annotation"><span class="hljs-meta">@SpringBootApplication<br />
<span class="hljs-keyword">public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class<span class="hljs-class"> <span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProfiledemoApplication<span class="hljs-class"> {<br /><br />

    <span class="hljs-annotation"><span class="hljs-meta">@Value(<span class="hljs-string">"${app.name}")<br />
    <span class="hljs-keyword">private String name;<br />

    <span class="hljs-annotation"><span class="hljs-meta">@Autowired<br />
    <span class="hljs-keyword">private SendMessage sendMessage;<br /><br />

    <span class="hljs-annotation"><span class="hljs-meta">@PostConstruct<br />
    <span class="hljs-keyword">public<span class="hljs-function"> <span class="hljs-keyword">void<span class="hljs-function"> <span class="hljs-title">init<span class="hljs-function">(){<br />
        sendMessage.send();<span class="hljs-comment">// 会根据profile指定的环境实例化对应的类<br />
    }<br />

}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p>3、logback-spring.xml也支持有节点来支持区分</p>
<pre name="code" class="prettyprint"><code class="hljs xml has-numbering"><span class="hljs-pi"><span class="php"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0" encoding=<span class="hljs-string">"UTF-8"<span class="hljs-meta">?&gt;<br />
<span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">configuration<span class="hljs-tag">&gt;<br />
    <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">include<span class="hljs-tag"> <span class="hljs-attribute"><span class="hljs-tag"><span class="hljs-attr">resource<span class="hljs-tag">=<span class="hljs-value"><span class="hljs-tag"><span class="hljs-string">"org/springframework/boot/logging/logback/base.xml"<span class="hljs-tag"> /&gt;<br />
    <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">logger<span class="hljs-tag"> <span class="hljs-attribute"><span class="hljs-tag"><span class="hljs-attr">name<span class="hljs-tag">=<span class="hljs-value"><span class="hljs-tag"><span class="hljs-string">"org.springframework.web"<span class="hljs-tag"> <span class="hljs-attribute"><span class="hljs-tag"><span class="hljs-attr">level<span class="hljs-tag">=<span class="hljs-value"><span class="hljs-tag"><span class="hljs-string">"INFO"<span class="hljs-tag">/&gt;<br /><br />

    <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">springProfile<span class="hljs-tag"> <span class="hljs-attribute"><span class="hljs-tag"><span class="hljs-attr">name<span class="hljs-tag">=<span class="hljs-value"><span class="hljs-tag"><span class="hljs-string">"default"<span class="hljs-tag">&gt;<br />
        <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">logger<span class="hljs-tag"> <span class="hljs-attribute"><span class="hljs-tag"><span class="hljs-attr">name<span class="hljs-tag">=<span class="hljs-value"><span class="hljs-tag"><span class="hljs-string">"org.springboot.sample"<span class="hljs-tag"> <span class="hljs-attribute"><span class="hljs-tag"><span class="hljs-attr">level<span class="hljs-tag">=<span class="hljs-value"><span class="hljs-tag"><span class="hljs-string">"TRACE"<span class="hljs-tag"> /&gt;<br />
    <span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">springProfile<span class="hljs-tag">&gt;<br /><br />

    <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">springProfile<span class="hljs-tag"> <span class="hljs-attribute"><span class="hljs-tag"><span class="hljs-attr">name<span class="hljs-tag">=<span class="hljs-value"><span class="hljs-tag"><span class="hljs-string">"dev"<span class="hljs-tag">&gt;<br />
        <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">logger<span class="hljs-tag"> <span class="hljs-attribute"><span class="hljs-tag"><span class="hljs-attr">name<span class="hljs-tag">=<span class="hljs-value"><span class="hljs-tag"><span class="hljs-string">"org.springboot.sample"<span class="hljs-tag"> <span class="hljs-attribute"><span class="hljs-tag"><span class="hljs-attr">level<span class="hljs-tag">=<span class="hljs-value"><span class="hljs-tag"><span class="hljs-string">"DEBUG"<span class="hljs-tag"> /&gt;<br />
    <span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">springProfile<span class="hljs-tag">&gt;<br /><br />

    <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">springProfile<span class="hljs-tag"> <span class="hljs-attribute"><span class="hljs-tag"><span class="hljs-attr">name<span class="hljs-tag">=<span class="hljs-value"><span class="hljs-tag"><span class="hljs-string">"staging"<span class="hljs-tag">&gt;<br />
        <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">logger<span class="hljs-tag"> <span class="hljs-attribute"><span class="hljs-tag"><span class="hljs-attr">name<span class="hljs-tag">=<span class="hljs-value"><span class="hljs-tag"><span class="hljs-string">"org.springboot.sample"<span class="hljs-tag"> <span class="hljs-attribute"><span class="hljs-tag"><span class="hljs-attr">level<span class="hljs-tag">=<span class="hljs-value"><span class="hljs-tag"><span class="hljs-string">"INFO"<span class="hljs-tag"> /&gt;<br />
    <span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">springProfile<span class="hljs-tag">&gt;<br />

<span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">configuration<span class="hljs-tag">&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p>再说一遍文件名不要用logback.xml 请使用logback-spring.xml</p>
<h3 id="四指定外部的配置文件">四、指定外部的配置文件</h3>
<p>有些系统，关于一些数据库或其他第三方账户等信息，由于安全问题，其配置并不会提前配置在项目中暴露给开发人员。<br />对于这种情况，我们在运行程序的时候，可以通过参数指定一个外部配置文件。<br />以 demo.jar 为例，方法如下：</p>
<pre name="code" class="prettyprint"><code class="hljs avrasm has-numbering javascript">java -jar demo<span class="hljs-preprocessor">.jar --spring<span class="hljs-preprocessor">.config<span class="hljs-preprocessor">.location=<span class="hljs-regexp">/opt/config/application<span class="hljs-preprocessor">.properties</span></span></span></span></span></code></code></pre>
<p>其中文件名随便定义，无固定要求。</p>
<h3 id="五创建一个linux-应用的sh脚本">五、创建一个Linux 应用的sh脚本</h3>
<p>下面几个脚本仅供参考，请根据自己需要做调整<br />start.sh</p>
<pre name="code" class="prettyprint"><code class="hljs bash has-numbering"><span class="hljs-shebang"><span class="hljs-meta">#!/bin/sh

rm <span class="hljs-operator">-f tpid<br />

nohup java -jar myapp.jar --spring.config.location=application.yml &gt; /dev/null <span class="hljs-number">2&gt;&amp;<span class="hljs-number">1 &amp;

<span class="hljs-built_in">echo $! &gt; tpid<br />

<span class="hljs-built_in">echo Start Success!<br />
</span></span></span></span></span></span></span></code></code></pre>
<p>stop.sh</p>
<p>&nbsp;</p>
<pre name="code" class="prettyprint"><code class="hljs bash has-numbering"><span class="hljs-shebang"><span class="hljs-meta">#!/bin/sh
APP_NAME=myapp

tpid=`ps -ef|grep <span class="hljs-variable">$APP_NAME|grep -v grep|grep -v <span class="hljs-built_in">kill|awk <span class="hljs-string">'{print $2}'`<br />
<span class="hljs-keyword">if [ <span class="hljs-variable">${tpid} ]; <span class="hljs-keyword">then<br />
    <span class="hljs-built_in">echo <span class="hljs-string">'Stop Process...'<br />
    <span class="hljs-built_in">kill -<span class="hljs-number">15 <span class="hljs-variable">$tpid<br />
<span class="hljs-keyword">fi<br />
sleep <span class="hljs-number">5<br />
tpid=`ps -ef|grep <span class="hljs-variable">$APP_NAME|grep -v grep|grep -v <span class="hljs-built_in">kill|awk <span class="hljs-string">'{print $2}'`<br />
<span class="hljs-keyword">if [ <span class="hljs-variable">${tpid} ]; <span class="hljs-keyword">then<br />
    <span class="hljs-built_in">echo <span class="hljs-string">'Kill Process!'<br />
    <span class="hljs-built_in">kill -<span class="hljs-number">9 <span class="hljs-variable">$tpid<br />
<span class="hljs-keyword">else<br />
    <span class="hljs-built_in">echo <span class="hljs-string">'Stop Success!'<br />
<span class="hljs-keyword">fi<br /><br />

</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p>check.sh</p>
<pre name="code" class="prettyprint"><code class="hljs bash has-numbering"><span class="hljs-shebang"><span class="hljs-meta">#!/bin/sh
APP_NAME=myapp

tpid=`ps -ef|grep <span class="hljs-variable">$APP_NAME|grep -v grep|grep -v <span class="hljs-built_in">kill|awk <span class="hljs-string">'{print $2}'`<br />
<span class="hljs-keyword">if [ <span class="hljs-variable">${tpid} ]; <span class="hljs-keyword">then<br />
        <span class="hljs-built_in">echo <span class="hljs-string">'App is running.'<br />
<span class="hljs-keyword">else<br />
        <span class="hljs-built_in">echo <span class="hljs-string">'App is NOT running.'<br />
<span class="hljs-keyword">fi</span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p>kill.sh</p>
<pre name="code" class="prettyprint"><code class="hljs bash has-numbering"><span class="hljs-shebang"><span class="hljs-meta">#!/bin/sh
APP_NAME=myapp

tpid=`ps -ef|grep <span class="hljs-variable">$APP_NAME|grep -v grep|grep -v <span class="hljs-built_in">kill|awk <span class="hljs-string">'{print $2}'`<br />
<span class="hljs-keyword">if [ <span class="hljs-variable">${tpid} ]; <span class="hljs-keyword">then<br />
    <span class="hljs-built_in">echo <span class="hljs-string">'Kill Process!'<br />
    <span class="hljs-built_in">kill -<span class="hljs-number">9 <span class="hljs-variable">$tpid<br />
<span class="hljs-keyword">fi</span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<h3 id="六使用linux服务的方式启动停止重启">六、使用Linux服务的方式启动、停止、重启</h3>
<p>1、首先在 pom.xml 中配置插件</p>
<pre name="code" class="prettyprint"><code class="hljs xml has-numbering">    <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">build<span class="hljs-tag">&gt;<br />
        <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">plugins<span class="hljs-tag">&gt;<br />
            <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">plugin<span class="hljs-tag">&gt;<br />
                <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">groupId<span class="hljs-tag">&gt;org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">groupId<span class="hljs-tag">&gt;<br />
                <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">artifactId<span class="hljs-tag">&gt;spring-boot-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">artifactId<span class="hljs-tag">&gt;<br />
                <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">configuration<span class="hljs-tag">&gt;<br />
                    <span class="hljs-tag"><span class="hljs-tag">&lt;<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">executable<span class="hljs-tag">&gt;true<span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">executable<span class="hljs-tag">&gt;<br />
                <span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">configuration<span class="hljs-tag">&gt;
            <span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">plugin<span class="hljs-tag">&gt;<br />
        <span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">plugins<span class="hljs-tag">&gt;<br />
    <span class="hljs-tag"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="hljs-tag"><span class="hljs-name">build<span class="hljs-tag">&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p>特别注意一下&nbsp;<code>&lt;executable&gt;true&lt;/executable&gt;</code></p>
<p>2、然后正常使用&nbsp;<code>mvn clean package -Dmaven.test.skip=true</code>&nbsp;将工程打成jar包</p>
<p>3、上传jar包到服务器，假设部署路径为&nbsp;<code>/var/apps/myapp.jar</code>&nbsp;，使用命令做一个软连接到&nbsp;<code>/etc/init.d</code>&nbsp;目录，命令：</p>
<pre name="code" class="prettyprint"><code class="hljs avrasm has-numbering groovy">ln -s <span class="hljs-regexp">/var/apps<span class="hljs-regexp">/myapp<span class="hljs-preprocessor">.jar<span class="hljs-regexp"> /etc<span class="hljs-regexp">/init<span class="hljs-preprocessor">.d<span class="hljs-regexp">/myapp</span></span></span></span></span></span></span></code></code></pre>
<p>其中&nbsp;<code>/etc/init.d/myapp</code>&nbsp;最后的 myapp 可以是别的名字，这个就是服务名，我们后面使用&nbsp;<code>service [服务名] start</code>&nbsp;来启动（下面有说明）。</p>
<p>4、给jar文件授予可执行权限，命令：</p>
<pre name="code" class="prettyprint"><code class="hljs perl has-numbering"><span class="hljs-keyword">chmod +<span class="hljs-keyword">x myapp.jar</span></span></code></code></pre>
<p>5、接下来，就可以使用我们熟悉的&nbsp;<code>service myapp start|stop|restart|status</code>&nbsp;来对应用进行启停了。<br />执行命令后将得到形如 Started|Stopped [PID] 的结果反馈。<br />默认PID文件路径：/var/run/appname/appname.pid<br />默认服务日志文件路径：/var/log/appname.log（可以通过下面.conf 的方式修改<code>LOG_FOLDER</code>）</p>
<p>6、使用自定义的.conf文件来变更默认配置，方法如下：<br />在jar包相同路径下创建一个.conf文件，名称应该与.jar的名称相同，如myapp.conf（如果我们打包的文jar文件为 myapp-1.0.0.jar 那么这里的conf文件也应该是 myapp-1.0.0.conf），其内容配置可以如下：</p>
<pre name="code" class="prettyprint"><code class="hljs ini has-numbering"><span class="hljs-setting"><span class="hljs-attr">JAVA_HOME=<span class="hljs-value">/usr/local/jdk<br /><br />
<span class="hljs-setting"><span class="hljs-attr">JAVA_OPTS=<span class="hljs-value">-Xmx1024M<br />
<span class="hljs-setting"><span class="hljs-attr">LOG_FOLDER=<span class="hljs-value">/data/logs/myapp</span></span></span></span></span></span></span></span></span></code></code></pre>
<p>注：LOG_FOLDER 对应的文件夹目录要必须存在，如果目录不存在，服务并不会自从创建目录。</p>
<p>&nbsp;</p>
<p>如果你是CentOS 7或红帽7以上，你还可以用下面的方法处理，为什么要用这样的方法（请自行研究），这里直接提供结果，哈哈<br /><strong>编辑服务文件 vim /usr/lib/systemd/system/myapp.service</strong></p>
<pre name="code" class="prettyprint"><code class="hljs ini has-numbering"><span class="hljs-title">[Unit]<br />
<span class="hljs-setting"><span class="hljs-attr">Description=<span class="hljs-value">myapp<br />
<span class="hljs-setting"><span class="hljs-attr">After=<span class="hljs-value">network.target<br /><br />
<span class="hljs-section">
<span class="hljs-title">[Service]<br />
<span class="hljs-setting"><span class="hljs-attr">WorkingDirectory=<span class="hljs-value">/var/apps/myapp<br />
<span class="hljs-setting"><span class="hljs-attr">ExecStart=<span class="hljs-value">/usr/local/java/bin/java -Dsun.misc.URLClassPath.disableJarChecking=<span class="hljs-keyword"><span class="hljs-literal">true -jar /var/apps/myapp.jar<br />
<span class="hljs-setting"><span class="hljs-attr">ExecStop=<span class="hljs-value">kill <span class="hljs-variable">$MAINPID<br />
<span class="hljs-setting"><span class="hljs-attr">Restart=<span class="hljs-value">always<br /><br />
<span class="hljs-section">
<span class="hljs-title">[Install]<br />
<span class="hljs-setting"><span class="hljs-attr">WantedBy=<span class="hljs-value">multi-user.target</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p><strong>使用Linux 7 以后服务新的启动方式，相关命令</strong></p>
<pre name="code" class="prettyprint"><code class="hljs sql has-numbering">启动
systemctl <span class="hljs-operator"><span class="hljs-keyword"><span class="hljs-keyword">start myapp
停止
systemctl <span class="hljs-keyword">stop myapp
重启
systemctl restart myapp
查看日志
journalctl -u myapp
关于更多 systemctl 命令的使用方法，度娘有很多。</span></span></span></span></code></code></pre>
<p><span style="color: #800000; font-size: 18pt;"><strong>三、aop</strong></span></p>
<h3>1、添加pom依赖</h3>
<pre class="prettyprint"><code class="prism language-xml has-numbering"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;dependency<span class="token punctuation">&gt;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;groupId<span class="token punctuation">&gt;org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/groupId<span class="token punctuation">&gt;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;artifactId<span class="token punctuation">&gt;spring-boot-starter-aop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/artifactId<span class="token punctuation">&gt;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/dependency<span class="token punctuation">&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code><br /><br /></code></pre>
<p>它依赖于org.aspectj.aspectjweaver，而常用的aop注解都在这个包下org.aspectj.lang.annotation，像 @Before、@After、@AfterReturning、@AfterThrowing、@Around、@Pointcut等。</p>
<p>通知方法：</p>
<p>前置通知(@Before)： 在目标方法运行之前执行。<br />后置通知(@After)： 在目标方法运行结束之后执行，不管正常结束还是异常结束，都会执行。<br />返回通知(@AfterReturn)： 在目标方法正常放回之后执行。<br />异常通知(@AfterThrowing)： 在目标方法出现异常以后执行。<br />环绕通知(@Around)： 动态代理，手动推进目标方法的执行。</p>
<p>2、Aop例子<br />@Aspect<br />public class LogAspects {</p>
<p>	// 抽取公共的切入点表达式<br />	@Pointcut("execution(* org.com.cay.spring.annotation.aop.*.*(..))")<br />	public void logging() {<br />	}</p>
<p>	@Before(value = "logging()")<br />	public void logStart(JoinPoint joinPoint) {<br />		System.out<br />				.println(joinPoint.getSignature().getName() + "运行，参数列表是: {" + Arrays.asList(joinPoint.getArgs()) + "}");<br />	}</p>
<p>	@After(value = "logging()")<br />	public void logEnd(JoinPoint joinPoint) {<br />		System.out.println(joinPoint.getSignature().getName() + "结束...");<br />	}</p>
<p>	@AfterReturning(value = "logging()", returning = "result")<br />	public void logReturn(JoinPoint joinPoint, Object result) {<br />		System.out.println(joinPoint.getSignature().getName() + "正常结束，结果是: {" + result + "}");<br />	}</p>
<p>	@AfterThrowing(value = "logging()", throwing = "e")<br />	public void logException(JoinPoint joinPoint, Exception e) {<br />		System.out.println(joinPoint.getSignature().getName() + "异常，异常信息: {" + e.getMessage() + "}");<br />	}<br />}<br /><br /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #800000;"><strong><span style="font-size: 18pt;">四、日志</span></strong></span></p>
<p>本节将通过配置Spring Boot的默认日志logback来实现日志管理。</p>
<h2 id="articleHeader3">说明</h2>
<p>日志级别从低到高分：</p>
<pre class="hljs nginx"><code><span class="hljs-attribute">TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL 
</span></code></code></pre>
<h2 id="articleHeader4">配置</h2>
<p>在src/main/resources下面添加logback.xml，内容如下：</p>
<pre class="hljs xml"><code><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
<span class="hljs-tag">&lt;<span class="hljs-name">configuration&gt;
    <span class="hljs-comment">&lt;!--======================================= 本地变量 ======================================== --&gt;
    <span class="hljs-comment">&lt;!--在没有定义${LOG_HOME}系统变量的时候，可以设置此本地变量。提交测试、上线时，要将其注释掉，使用系统变量。 --&gt;
    <span class="hljs-comment">&lt;!-- &lt;property name="LOG_HOME" value="D:/data/logs" /&gt; --&gt;

    <span class="hljs-comment">&lt;!-- 应用名称：和统一配置中的项目代码保持一致（小写） --&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">property <span class="hljs-attr">name=<span class="hljs-string">"APP_NAME" <span class="hljs-attr">value=<span class="hljs-string">"base" /&gt;
    <span class="hljs-comment">&lt;!--日志文件保留天数 --&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">property <span class="hljs-attr">name=<span class="hljs-string">"LOG_MAX_HISTORY" <span class="hljs-attr">value=<span class="hljs-string">"180" /&gt;
    <span class="hljs-comment">&lt;!--定义日志文件的存储地址 勿在 LogBack 的配置中使用相对路径 --&gt;
    <span class="hljs-comment">&lt;!--应用日志文件保存路径 --&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">property <span class="hljs-attr">name=<span class="hljs-string">"LOG_APP_HOME" <span class="hljs-attr">value=<span class="hljs-string">"${APP_NAME}/app" /&gt;

    <span class="hljs-comment">&lt;!--=========================== 按照每天生成日志文件：默认配置=================================== --&gt;
    <span class="hljs-comment">&lt;!-- 控制台输出 --&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">appender <span class="hljs-attr">name=<span class="hljs-string">"STDOUT" <span class="hljs-attr">class=<span class="hljs-string">"ch.qos.logback.core.ConsoleAppender"&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">encoder <span class="hljs-attr">class=<span class="hljs-string">"ch.qos.logback.classic.encoder.PatternLayoutEncoder"&gt;
            <span class="hljs-comment">&lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度%msg：日志消息，%n是换行符 --&gt;
            <span class="hljs-tag">&lt;<span class="hljs-name">pattern&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">appender&gt;
    <span class="hljs-comment">&lt;!-- 按照每天生成日志文件：主项目日志 --&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">appender <span class="hljs-attr">name=<span class="hljs-string">"APP"
        <span class="hljs-attr">class=<span class="hljs-string">"ch.qos.logback.core.rolling.RollingFileAppender"&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy <span class="hljs-attr">class=<span class="hljs-string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;
            <span class="hljs-comment">&lt;!--日志文件输出的文件名 --&gt;
            <span class="hljs-tag">&lt;<span class="hljs-name">FileNamePattern&gt;${LOG_APP_HOME}/base.%d{yyyy-MM-dd}.log
            <span class="hljs-tag">&lt;/<span class="hljs-name">FileNamePattern&gt;
            <span class="hljs-comment">&lt;!--日志文件保留天数 --&gt;
            <span class="hljs-tag">&lt;<span class="hljs-name">MaxHistory&gt;${LOG_MAX_HISTORY}<span class="hljs-tag">&lt;/<span class="hljs-name">MaxHistory&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">encoder <span class="hljs-attr">class=<span class="hljs-string">"ch.qos.logback.classic.encoder.PatternLayoutEncoder"&gt;
            <span class="hljs-comment">&lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度%msg：日志消息，%n是换行符 --&gt;
            <span class="hljs-tag">&lt;<span class="hljs-name">pattern&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{500} - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">appender&gt;
    <span class="hljs-comment">&lt;!--=============================== 日志输出: 默认主业务日志 ====================================== --&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">logger <span class="hljs-attr">name=<span class="hljs-string">"org.springframework"&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">level <span class="hljs-attr">value=<span class="hljs-string">"WARN" /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">logger&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">logger <span class="hljs-attr">name=<span class="hljs-string">"org.apache.shiro"&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">level <span class="hljs-attr">value=<span class="hljs-string">"WARN" /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">logger&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">logger <span class="hljs-attr">name=<span class="hljs-string">"freemarker"&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">level <span class="hljs-attr">value=<span class="hljs-string">"WARN" /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">logger&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">logger <span class="hljs-attr">name=<span class="hljs-string">"org.hibernate"&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">level <span class="hljs-attr">value=<span class="hljs-string">"WARN" /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">logger&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">logger <span class="hljs-attr">name=<span class="hljs-string">"org.hibernate.SQL"&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">level <span class="hljs-attr">value=<span class="hljs-string">"DEBUG" /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">logger&gt;
    
    <span class="hljs-tag">&lt;<span class="hljs-name">root <span class="hljs-attr">level=<span class="hljs-string">"DEBUG"&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref <span class="hljs-attr">ref=<span class="hljs-string">"APP" /&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref <span class="hljs-attr">ref=<span class="hljs-string">"STDOUT" /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">root&gt;
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration&gt;
</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<h2 id="articleHeader5">配置application.properties</h2>
<pre class="hljs groovy"><code>logging.config=<span class="hljs-string">classpath:logback.xml</span></code></code></pre>
<p><span style="color: #800000; font-size: 18pt;"><strong>五、自定义事件处理</strong></span></p>
<h4>统一返回结果集</h4>
<p>不要使用 Map 来返回结果, Map 不易控制且容易犯错, 应该定义一个 Java 实体类. 来表示统一结果来返回, 如定义实体类:</p>
<pre class="java hljs"><code class="java"><span class="hljs-keyword">public <span class="hljs-class"><span class="hljs-keyword">class <span class="hljs-title">ResultBean&lt;<span class="hljs-title">T&gt; {
    <span class="hljs-keyword">private <span class="hljs-keyword">int code;
    <span class="hljs-keyword">private String message;
    <span class="hljs-keyword">private Collection&lt;T&gt; data;

    <span class="hljs-function"><span class="hljs-keyword">private <span class="hljs-title">ResultBean<span class="hljs-params">() {

    }

    <span class="hljs-function"><span class="hljs-keyword">public <span class="hljs-keyword">static ResultBean <span class="hljs-title">error<span class="hljs-params">(<span class="hljs-keyword">int code, String message) {
        ResultBean resultBean = <span class="hljs-keyword">new ResultBean();
        resultBean.setCode(code);
        resultBean.setMessage(message);
        <span class="hljs-keyword">return resultBean;
    }

    <span class="hljs-function"><span class="hljs-keyword">public <span class="hljs-keyword">static ResultBean <span class="hljs-title">success<span class="hljs-params">() {
        ResultBean resultBean = <span class="hljs-keyword">new ResultBean();
        resultBean.setCode(<span class="hljs-number">0);
        resultBean.setMessage(<span class="hljs-string">"success");
        <span class="hljs-keyword">return resultBean;
    }

    <span class="hljs-keyword">public <span class="hljs-keyword">static &lt;V&gt; <span class="hljs-function">ResultBean&lt;V&gt; <span class="hljs-title">success<span class="hljs-params">(Collection&lt;V&gt; data) {
        ResultBean resultBean = <span class="hljs-keyword">new ResultBean();
        resultBean.setCode(<span class="hljs-number">0);
        resultBean.setMessage(<span class="hljs-string">"success");
        resultBean.setData(data);
        <span class="hljs-keyword">return resultBean;
    }

    <span class="hljs-comment">// getter / setter 略
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<ul>
<li>正常情况: 调用&nbsp;<code>ResultBean.success()</code>&nbsp;或&nbsp;<code>ResultBean.success(Collection&lt;V&gt; data)</code>, 不需要返回数据, 即调用前者, 需要返回数据, 调用后者. 如:</li>
</ul>
<pre class="java hljs"><code class="java"><span class="hljs-meta">@RequestMapping(<span class="hljs-string">"/goods/add")
<span class="hljs-meta">@ResponseBody
<span class="hljs-function"><span class="hljs-keyword">public ResultBean&lt;Goods&gt; <span class="hljs-title">getAllGoods<span class="hljs-params">() {
    List&lt;Goods&gt; goods = goodsService.findAll();
    <span class="hljs-keyword">return ResultBean.success(goods);
}
<span class="hljs-meta">@RequestMapping(<span class="hljs-string">"/goods/update")
<span class="hljs-meta">@ResponseBody
<span class="hljs-function"><span class="hljs-keyword">public ResultBean <span class="hljs-title">updateGoods<span class="hljs-params">(Goods goods) {
    goodsService.update(goods);
    <span class="hljs-keyword">return ResultBean.success();
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p>一般只有查询方法需要调用&nbsp;<code>ResultBean.success(Collection&lt;V&gt; data)</code>&nbsp;来返回 N 条数据, 其他诸如删除, 修改等方法都应该调用&nbsp;<code>ResultBean.success()</code>, 即在业务代码中只处理正确的功能, 不对异常做任何判断. 也不需要对 update 或 delete 的更新条数做判断(个人建议, 实际需要根据业务). 只要没有抛出异常, 我们就认为用户操作成功了. 且操作成功的提示信息在前端处理, 不要后台返回 &ldquo;操作成功&rdquo; 等字段.</p>
<p>前台接受到的信息为:</p>
<pre class="javascript hljs"><code class="javascript">{
    <span class="hljs-string">"code": <span class="hljs-number">0,
    <span class="hljs-string">"message": <span class="hljs-string">"success",
    <span class="hljs-string">"data": [
        {
            <span class="hljs-string">"name": <span class="hljs-string">"商品1",
            <span class="hljs-string">"price": <span class="hljs-number">50.00,
        },
        {
            <span class="hljs-string">"name": <span class="hljs-string">"商品2",
            <span class="hljs-string">"price": <span class="hljs-number">99.99,
        }
    ]
}</span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<ul>
<li>抛出异常: 抛出异常后, 我们应该调用&nbsp;<code>ResultBean.error(int code, String message)</code>, 来将状态码和错误信息返回, 我们约定&nbsp;<code>code</code>&nbsp;为 0 表示操作成功,&nbsp;<code>1</code>&nbsp;或&nbsp;<code>2</code>&nbsp;等正数表示用户输入错误,&nbsp;<code>-1</code>,&nbsp;<code>-2</code>&nbsp;等负数表示系统错误.</li>
</ul>
<p>前台接受到的信息为:</p>
<pre class="javascript hljs"><code class="javascript">{
    <span class="hljs-string">"code": <span class="hljs-number">-1,
    <span class="hljs-string">"message": <span class="hljs-string">"XXX 参数有问题, 请重新填写",
    <span class="hljs-string">"data": <span class="hljs-literal">null
}</span></span></span></span></span></span></code></code></pre>
<h4>前端统一处理:</h4>
<p>返回的结果集规范后, 前端就很好处理了:</p>
<pre class="javascript hljs"><code class="javascript"><span class="hljs-comment">/**
 * 显示错误信息
 * @param result： 错误信息
 */
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">showError(<span class="hljs-params">s) {
    alert(s);
}

<span class="hljs-comment">/**
 * 处理 ajax 请求结果
 * @param result： ajax 返回的结果
 * @param fn： 成功的处理函数 ( 传入data: fn(result.data) )
 */
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">handlerResult(<span class="hljs-params">result, fn) {
    <span class="hljs-comment">// 成功执行操作，失败提示原因
    <span class="hljs-keyword">if (result.code == <span class="hljs-number">0) {
        fn(result.data);
    }
    <span class="hljs-comment">// 用户操作异常, 这里可以对 1 或 2 等错误码进行单独处理, 也可以 result.code &gt; 0 来粗粒度的处理, 根据业务而定.
    <span class="hljs-keyword">else <span class="hljs-keyword">if (result.code == <span class="hljs-number">1) {
        showError(result.message);
    }
    <span class="hljs-comment">// 系统异常, 这里可以对 -1 或 -2 等错误码进行单独处理, 也可以 result.code &gt; 0 来粗粒度的处理, 根据业务而定.
    <span class="hljs-keyword">else <span class="hljs-keyword">if (result.code == <span class="hljs-number">-1) {
        showError(result.message);
    }
    <span class="hljs-comment">// 如果进行细粒度的状态码判断, 那么就应该重点注意这里没出现过的状态码. 这个判断仅建议在开发阶段保留用来发现未定义的状态码.
    <span class="hljs-keyword">else {
        showError(<span class="hljs-string">"出现未定义的状态码:" + result.code);
    }
}

<span class="hljs-comment">/**
 * 根据 id 删除商品
 */
<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">deleteGoods(<span class="hljs-params">id) {
    $.ajax({
        <span class="hljs-attr">type: <span class="hljs-string">"GET",
        <span class="hljs-attr">url: <span class="hljs-string">"/goods/delete",
        <span class="hljs-attr">dataType: <span class="hljs-string">"json",
        <span class="hljs-attr">success: <span class="hljs-function"><span class="hljs-keyword">function(<span class="hljs-params">result){
            handlerResult(result, deleteDone);
        }
    });
}

<span class="hljs-function"><span class="hljs-keyword">function <span class="hljs-title">deleteDone(<span class="hljs-params">data) {
    alert(<span class="hljs-string">"删除成功");
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p><code>showError</code>&nbsp;和&nbsp;<code>handlerResult</code>&nbsp;是公共方法, 分别用来显示错误和统一处理结果集.</p>
<p>然后将主要精力放在发送请求和处理正确结果的方法上即可, 如这里的 deleteDone 函数, 用来处理操作成功给用户的提示信息, 正所谓各司其职, 前端负责操作成功的消息提示更合理, 而错误信息只有后台知道, 所以需要后台来返回.</p>
<h4>后端统一处理异常</h4>
<p>说了这么多, 还没讲到后端不在业务层捕获任何异常的事, 既然所有业务层都没有捕获异常, 那么所有的异常都会抛出到 Controller 层, 我们只需要用 AOP 对 Controller 层的所有方法处理即可.</p>
<p>好在 Spring 为我们提供了一个注解, 用来统一处理异常:</p>
<pre class="java hljs"><code class="java"><span class="hljs-meta">@ControllerAdvice
<span class="hljs-meta">@ResponseBody
<span class="hljs-keyword">public <span class="hljs-class"><span class="hljs-keyword">class <span class="hljs-title">WebExceptionHandler {

    <span class="hljs-keyword">private <span class="hljs-keyword">static <span class="hljs-keyword">final Logger log = LoggerFactory.getLogger(WebExceptionHandler.class);

    <span class="hljs-meta">@ExceptionHandler
    <span class="hljs-function"><span class="hljs-keyword">public ResultBean <span class="hljs-title">unknownAccount<span class="hljs-params">(UnknownAccountException e) {
        log.error(<span class="hljs-string">"账号不存在", e);
        <span class="hljs-keyword">return ResultBean.error(<span class="hljs-number">1, <span class="hljs-string">"账号不存在");
    }

    <span class="hljs-meta">@ExceptionHandler
    <span class="hljs-function"><span class="hljs-keyword">public ResultBean <span class="hljs-title">incorrectCredentials<span class="hljs-params">(IncorrectCredentialsException e) {
        log.error(<span class="hljs-string">"密码错误", e);
        <span class="hljs-keyword">return ResultBean.error(-<span class="hljs-number">2, <span class="hljs-string">"密码错误");
    }

    <span class="hljs-meta">@ExceptionHandler
    <span class="hljs-function"><span class="hljs-keyword">public ResultBean <span class="hljs-title">unknownException<span class="hljs-params">(Exception e) {
        log.error(<span class="hljs-string">"发生了未知异常", e);
        <span class="hljs-comment">// 发送邮件通知技术人员.
        <span class="hljs-keyword">return ResultBean.error(-<span class="hljs-number">99, <span class="hljs-string">"系统出现错误, 请联系网站管理员!");
    }
}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p>在这里统一配置需要处理的异常, 同样, 对于未知的异常, 一定要及时发现, 并进行处理. 推荐出现未知异常后发送邮件, 提示技术人员.</p>
<h3 id="articleHeader3">总结</h3>
<p>总结一下统一异常处理的方法:</p>
<ul>
<li>不使用随意返回各种数据类型, 要统一返回值规范.</li>
<li>不在业务代码中捕获任何异常, 全部交由&nbsp;<code>@ControllerAdvice</code>&nbsp;来处理.</li>
</ul>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>