<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修ActiveMQ学习总结------原生实战操作（上）02' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>ActiveMQ学习总结------原生实战操作（上）02</center></div><div class='banquan'>原文出处:本文由博客园博主Arebirth提供。<br/>
原文连接:https://www.cnblogs.com/arebirth/p/activemq02.html</div><br>
    <h1>相信大家通过上一篇博文已经对ActiveMQ有了一个大致的概念了，</h1>
<h1>那么本篇博文将带领大家一步一步去实战操作我们的ActiveMQ</h1>
<p><strong>本篇主要内容：</strong></p>
<p>　　1.ActiveMQ术语及API介绍</p>
<p>　　2.ActiveMQ 文本消息处理</p>
<p>　　3.ActiveMQ 对象消息处理</p>
<hr />
<h2>既然我们要学习如何实战操作了，那么久不可不知它的一些术语和API的用于</h2>
<p><strong>即使觉得枯燥，我们也要大致看一眼，过后相信你还会再来看的！因为很有用</strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>一&nbsp;ActiveMQ 的术语（这么碉堡的东西怎么会没有写让人觉得更碉堡的词汇呢？）</h3>
<blockquote>
<h4>1 Destination</h4>
<p>目的地，JMS Provider（消息中间件）负责维护，用于对 Message 进行管理的对象。<br />MessageProducer 需要指定 Destination 才能发送消息，MessageReceiver 需要指定 Destination<br />才能接收消息。</p>
<p>&nbsp;</p>
<h4>2 Producer</h4>
<p>消息生成者，负责发送 Message 到目的地。</p>
<p>&nbsp;</p>
<h4>3 Consumer | Receiver</h4>
<p>消息消费者，负责从目的地中消费【处理|监听|订阅】Message。</p>
<p>&nbsp;</p>
<h4>4 Message</h4>
<p>消息，消息封装一次通信的内容。</p>



</blockquote>
<h3>&nbsp;</h3>
<hr />
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>二 ActiveMQ API简介</h2>
<blockquote>
<p><strong>下述API都是接口类型，由定义在javax.jms包中</strong></p>
<p><strong>都是JMS（Java Message Service）标准接口定义</strong></p>
<p>&nbsp;</p>
<p><strong>1.ConnectionFactory</strong></p>
<p><strong>　　链接工厂，用于创建链接的工厂类型</strong></p>
<p><strong>2.Connection</strong></p>
<p>　　链接，用于建立访问ActiveMQ连接的类型，由链接工厂ConnectionFactory创建</p>
<p><strong>3.Session</strong></p>
<p>　　会话，一次持久有效有状态的访问，由链接创建</p>
<p><strong>4.Destination &amp; Queue</strong></p>
<p>　　目的地。用于描述本次访问ActiveMQ的消息访问目的地，即ActiveMQ服务中的具体队列，由会话创建</p>
<p>　　interface Queue extends Destination</p>
<p><strong>5.MessageProducer</strong></p>
<p>　　消息生成者、在一次有效会话中，用于发送消息给ActiveMQ服务的工具，由会话创建</p>
<p><strong>6.MessageConsumer</strong></p>
<p>　　消息消费者【消息订阅者|消息处理着】，在一次有效会话中，用于从ActiveMQ服务中获取消息的工具，由会话创建</p>
<p><strong>7.Message</strong></p>
<p>　　消息。通过消息生成者向ActiveMQ服务发送消息时使用的数据载体对象或消费者从ActiveMQ服务中获取消息时使用的数据载体对象。是所有消息【文本消息|对象消息等】具体类型的顶级接口，可以通过会话创建或通过会话从ActiveMQ服务中获取</p>
<p>&nbsp;</p>
<p>&nbsp;</p>



</blockquote>
<p>&nbsp;</p>
<hr />
<p>&nbsp;</p>
<h2>三 ActiveMQ处理文本消息</h2>
<p><span style="color: #ff0000;">注</span>：*本案例将以producer（消息生产者）和consumer（消息发送者）两个模块为例</p>
<p>&nbsp;</p>
<p><strong>准备工作：</strong></p>
<p><strong>　</strong>　确保你的ActiveMQ已经开启，并且所依赖的端口已经关闭（建议直接关闭防火墙 service iptables stop）</p>
<p>　　Maven环境</p>
<p>&nbsp;</p>
<h3>1 消息生产者</h3>
<blockquote>
<p><strong>1.1创建模块</strong></p>
<p><img src="./images/ActiveMQ学习总结------原生实战操作（上）020.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong>1,2在POM文件添加ActiveMQ的依赖（根据个人的ActiveMQ版本自行查找）</strong></p>
<src class="cnblogs_code">
<pre><code> &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;
            &lt;artifactId&gt;activemq-all&lt;/artifactId&gt;
            &lt;version&gt;<span style="color: #800080;">5.9</span>.<span style="color: #800080;">0</span>&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;</code></pre>

<p>&nbsp;</p>
<p><strong>1.3 编写消息的生产者</strong></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.arebirth.mq;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.activemq.ActiveMQConnectionFactory;

</span><span style="color: #0000ff;">import</span> javax.jms.*<span style="color: #000000;">;

</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ActiveMQTextProducer {
    
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> sendTextActiveMQ(String msg) {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义链接工厂</span>
        ConnectionFactory connectionFactory = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义链接对象</span>
        Connection connection = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义会话</span>
        Session session = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">目的地</span>
        Destination destination = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义消息的发送者</span>
        MessageProducer producer = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义消息</span>
        Message message = <span style="color: #0000ff;">null</span><span style="color: #000000;">;


        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            </span><span style="color: #008000;">/**</span><span style="color: #008000;">
             * userName:访问ActiveMQ服务的用户名，默认为admin。
             * password：访问ActiveMQ服务的密码，默认为admin
             * 用户名和用户密码都可以通过ActiveMQ安装目录的oonf目录下的jetty-ream.properties文件进行修改
             *
             * borkerURL：访问ActiveMQ服务的路径地址。
             *  路径结构为：协议名://主机地址:端口号
             *  在conf/activemq.xml文件中可以找到修改
             *  在上一篇文章中都有介绍
             </span><span style="color: #008000;">*/</span><span style="color: #000000;">
            connectionFactory </span>= <span style="color: #0000ff;">new</span> ActiveMQConnectionFactory("admin", "admin", "tcp://169.254.18.20:61616"<span style="color: #000000;">);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建链接对象</span>
            connection =<span style="color: #000000;"> connectionFactory.createConnection();

            </span><span style="color: #008000;">//</span><span style="color: #008000;">启动连接</span>
<span style="color: #000000;">            connection.start();

            </span><span style="color: #008000;">/**</span><span style="color: #008000;">
             * 参数一：transacted 是否使用事务 可选值为:true|false
             *      ture:使用事务 设置第二个参数变量这为 Session.SESSION_TRANSACTION 交由session管理
             *      false:不使用事务，则设置我们的参数即可
             *
             * acknowledgeMode:
             * * Session.AUTO_ACKNOWLEDGE:自动消息确认机制
             * * Session.CLIENT_ACKNOWLEDGE:客户端确认机制
             * * Session.DUPS_OK_ACKNOWLEDGE:有副本的客户端确认消息机制
             这里设置 这两个参数的含义为：
             不使用事务，并由Session自动确认提交
             * 这里对此不作过多讲解，初学者跟着敲，其后在慢慢了解原理
             *
             </span><span style="color: #008000;">*/</span><span style="color: #000000;">
            session </span>= connection.createSession(<span style="color: #0000ff;">false</span><span style="color: #000000;">, Session.AUTO_ACKNOWLEDGE);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建目的地，目的地名称即队列的名称，也就是保存我们消息地方的名称。消息的消费者需要通过此名称访问对应的队列
            </span><span style="color: #008000;">//</span><span style="color: #008000;">名称不固定</span>
            destination = session.createQueue("hello-mq"<span style="color: #000000;">);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建消息的生产者 需要指定目的地（也就是把Destination传入参数）</span>
            producer =<span style="color: #000000;"> session.createProducer(destination);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建消息对象 并传入我们需要放入队列的消息</span>
            message =<span style="color: #000000;"> session.createTextMessage(msg);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">发送消息</span>
<span style="color: #000000;">            producer.send(message);

        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
            e.printStackTrace();
        } </span><span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">回收消息发送者资源</span>
            <span style="color: #0000ff;">if</span> (producer != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    producer.close();
                } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JMSException e) {
                    e.printStackTrace();
                }
            }
            </span><span style="color: #0000ff;">if</span> (session != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    session.close();
                } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JMSException e) {
                    e.printStackTrace();
                }
            }
            </span><span style="color: #0000ff;">if</span> (connection != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    connection.close();
                } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JMSException e) {
                    e.printStackTrace();
                }
            }
        }


    }
}</span></code></pre>

<p>&nbsp;</p>
</blockquote>
<p>&nbsp;</p>
<h3>2. 消息消费者</h3>
<blockquote>
<p><strong>2.1创建模块</strong></p>
<p><strong><img src="./images/ActiveMQ学习总结------原生实战操作（上）021.png" alt="" /></strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong>2,2在POM文件添加ActiveMQ的依赖（根据个人的ActiveMQ版本自行查找）</strong></p>
<src class="cnblogs_code">
<pre><code> &lt;dependency&gt;
            &lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;
            &lt;artifactId&gt;activemq-all&lt;/artifactId&gt;
            &lt;version&gt;5.9.0&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>

<p>&nbsp;</p>
<p><strong>2.3编写消息的消费者</strong></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.arebirth.mq;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.activemq.ActiveMQConnectionFactory;

</span><span style="color: #0000ff;">import</span> javax.jms.*<span style="color: #000000;">;

</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ActiveMQTextConsumer {

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> receiveTextActiveMQ() {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义链接工厂</span>
        ConnectionFactory connectionFactory = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义链接对象</span>
        Connection connection = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义会话</span>
        Session session = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">目的地</span>
        Destination destination = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义消息的消费者（接收者）</span>
        MessageConsumer consumer = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义消息</span>
        Message message = <span style="color: #0000ff;">null</span><span style="color: #000000;">;


        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            </span><span style="color: #008000;">/**</span><span style="color: #008000;">
             * userName:访问ActiveMQ服务的用户名，默认为admin。
             * password：访问ActiveMQ服务的密码，默认为admin
             * 用户名和用户密码都可以通过ActiveMQ安装目录的oonf目录下的jetty-ream.properties文件进行修改
             *
             * borkerURL：访问ActiveMQ服务的路径地址。
             *  路径结构为：协议名://主机地址:端口号
             *  在conf/activemq.xml文件中可以找到修改
             *  在上一篇文章中都有介绍
             </span><span style="color: #008000;">*/</span><span style="color: #000000;">
            connectionFactory </span>= <span style="color: #0000ff;">new</span> ActiveMQConnectionFactory("admin", "admin", "tcp://169.254.18.20:61616"<span style="color: #000000;">);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建链接对象</span>
            connection =<span style="color: #000000;"> connectionFactory.createConnection();

            </span><span style="color: #008000;">//</span><span style="color: #008000;">启动连接</span>
<span style="color: #000000;">            connection.start();

            </span><span style="color: #008000;">/**</span><span style="color: #008000;">
             * 参数一：transacted 是否使用事务 可选值为:true|false
             *      ture:使用事务 设置第二个参数变量这为 Session.SESSION_TRANSACTION 交由session管理
             *      false:不使用事务，则设置我们的参数即可
             *
             * acknowledgeMode:
             * * Session.AUTO_ACKNOWLEDGE:自动消息确认机制
             * * Session.CLIENT_ACKNOWLEDGE:客户端确认机制
             * * Session.DUPS_OK_ACKNOWLEDGE:有副本的客户端确认消息机制
             这里设置 这两个参数的含义为：
             不使用事务，并由Session自动确认提交
             * 这里对此不作过多讲解，初学者跟着敲，其后在慢慢了解原理
             *
             </span><span style="color: #008000;">*/</span><span style="color: #000000;">
            session </span>= connection.createSession(<span style="color: #0000ff;">false</span><span style="color: #000000;">, Session.AUTO_ACKNOWLEDGE);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建目的地，目的地名称即队列的名称，也就是保存我们消息地方的名称。消息的消费者需要通过此名称访问对应的队列
            </span><span style="color: #008000;">//</span><span style="color: #008000;">名称不固定</span>
            destination = session.createQueue("hello-mq"<span style="color: #000000;">);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建消息的消费者 需要指定目的地（也就是把Destination传入参数）</span>
            consumer =<span style="color: #000000;"> session.createConsumer(destination);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建消息对象 由消费者接收消息</span>
            message =<span style="color: #000000;"> consumer.receive();

            </span><span style="color: #008000;">//</span><span style="color: #008000;">处理消息</span>
            String msg =<span style="color: #000000;"> ((TextMessage) message).getText();
            System.out.println(</span>"ActiveMQ say:" +<span style="color: #000000;"> msg);
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
            e.printStackTrace();
        } </span><span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">回收消息接收者资源</span>
            <span style="color: #0000ff;">if</span> (consumer != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    consumer.close();
                } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JMSException e) {
                    e.printStackTrace();
                }
            }
            </span><span style="color: #0000ff;">if</span> (session != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    session.close();
                } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JMSException e) {
                    e.printStackTrace();
                }
            }
            </span><span style="color: #0000ff;">if</span> (connection != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    connection.close();
                } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JMSException e) {
                    e.printStackTrace();
                }
            }
        }

    }
}</span></code></pre>

<p>&nbsp;</p>
</blockquote>
<p>&nbsp;</p>
<h3>3 测试成果</h3>
<blockquote>
<p>定义测试类，来测试我们的成果！</p>
<p>&nbsp;</p>
<p><strong>3.1 定义producer测试类</strong></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.arebirth.mq;

</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ProducerTest {
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
        ActiveMQTextProducer producer </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> ActiveMQTextProducer();
        producer.sendTextActiveMQ(</span>"Hello,ActiveMQ!"<span style="color: #000000;">);
    }
}</span></code></pre>

<p>当我们执行完这段代码后，我们打开我们的ActiveMQ的控制面板（首先你要启动你的ActiveMQ，上一篇有介绍到！）</p>
<p><img src="./images/ActiveMQ学习总结------原生实战操作（上）022.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong>接下来，当我们看到此图片内容即说明producer成果运行！（hello-mq我们自定义的队列名称！）</strong></p>
<p><img src="./images/ActiveMQ学习总结------原生实战操作（上）023.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr />
<p>&nbsp;</p>
<p><strong>3.2 定义 Consumer测试类</strong></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.arebirth.mq;

</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ConsumerTest {
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
        ActiveMQTextConsumer consumer </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> ActiveMQTextConsumer();
        consumer.receiveTextActiveMQ();
    }
}</span></code></pre>

<p>&nbsp;</p>
<p><strong>运行结果出现如下内容即成果！</strong></p>
<p><img src="./images/ActiveMQ学习总结------原生实战操作（上）024.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;<img src="./images/ActiveMQ学习总结------原生实战操作（上）025.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</blockquote>
<p>&nbsp;</p>
<p><strong>当我们仔细观察ActiveMQ控制台的时候会发现，</strong></p>
<p>　　producer每产生一条消息对应的Number Of Pending Message和Message Enqueued就+1</p>
<p>　　consumer每次启动消费消息的时候，Number Of pending Message就会-1&nbsp; Message Dequeued +1&nbsp;</p>
<p>为什么呢？哈哈&nbsp; 相信大家已经大概猜出来了或者看英文的意思　　</p>
<p><strong>介绍下：</strong></p>
<ul>
<li>Name:消息的名字</li>
<li>Number Of Pending Message:为消费的消息数量</li>
<li>Number Of Consumers:消费者的数量</li>
<li>Message Enqueued:队列共有过多少消息</li>
<li>Message Dequeued:消费者消费了多少条消息</li>
</ul>
<p>&nbsp;</p>
<p><strong>鼓捣完文本消息，那么有的人会说，只能鼓捣文本？？错了，接下来我们搞实用的对象！（不是你和我，是我们和电脑 -. -）</strong></p>
<hr />
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>四 ActiveMQ处理对象消息</h2>
<p>有了上面处理文本消息的基础，我们将很容易掌握处理对象消息的能力！这里面的步骤，我们将略省一部分，和上面及其相似</p>
<p>&nbsp;</p>
<h3>1 对象创建（处理对象消息，那么一定是要有个数据载体的对象啦，我们自己创建一个即可&nbsp; &nbsp; &nbsp;生产者和消费者均需要此对象！）</h3>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.arebirth.pojo;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.Serializable;

</span><span style="color: #008000;">/**</span><span style="color: #008000;">
 * 一定要序列化！！
 </span><span style="color: #008000;">*/</span>
<span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> User <span style="color: #0000ff;">implements</span><span style="color: #000000;"> Serializable {
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> String username;
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> String pwd;
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> String content;

    @Override
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String toString() {
        </span><span style="color: #0000ff;">return</span> "User{" +
                "username='" + username + '\'' +
                ", pwd='" + pwd + '\'' +
                ", content='" + content + '\'' +
                '}'<span style="color: #000000;">;
    }

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> User() {
    }

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> User(String username, String pwd, String content) {
        </span><span style="color: #0000ff;">this</span>.username =<span style="color: #000000;"> username;
        </span><span style="color: #0000ff;">this</span>.pwd =<span style="color: #000000;"> pwd;
        </span><span style="color: #0000ff;">this</span>.content =<span style="color: #000000;"> content;
    }

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String getUsername() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> username;
    }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setUsername(String username) {
        </span><span style="color: #0000ff;">this</span>.username =<span style="color: #000000;"> username;
    }

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String getPwd() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> pwd;
    }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setPwd(String pwd) {
        </span><span style="color: #0000ff;">this</span>.pwd =<span style="color: #000000;"> pwd;
    }

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String getContent() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> content;
    }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setContent(String content) {
        </span><span style="color: #0000ff;">this</span>.content =<span style="color: #000000;"> content;
    }
}</span></code></pre>

<p>&nbsp;</p>
<h3>2 消息生产者</h3>
<blockquote>
<h3>2.1 还是需要pom的jar包依赖的的，如果还在原来的环境上，则不需要添加啦！</h3>
<src class="cnblogs_code">
<pre><code>&lt;dependency&gt;
            &lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;
            &lt;artifactId&gt;activemq-all&lt;/artifactId&gt;
            &lt;version&gt;5.9.0&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>

<p>&nbsp;</p>
<p><strong>2.2 编写消息的生产者</strong></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.arebirth.mq;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> cn.arebirth.pojo.User;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.activemq.ActiveMQConnectionFactory;

</span><span style="color: #0000ff;">import</span> javax.jms.*<span style="color: #000000;">;

</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ActiveMQObjectProducer {

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> sendObjectActiveMQ(User user){
        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义链接工厂</span>
        ConnectionFactory connectionFactory = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义链接对象</span>
        Connection connection = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义会话</span>
        Session session = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">目的地</span>
        Destination destination = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义消息的发送者</span>
        MessageProducer producer = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义消息</span>
        Message message = <span style="color: #0000ff;">null</span><span style="color: #000000;">;


        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            </span><span style="color: #008000;">/**</span><span style="color: #008000;">
             * userName:访问ActiveMQ服务的用户名，默认为admin。
             * password：访问ActiveMQ服务的密码，默认为admin
             * 用户名和用户密码都可以通过ActiveMQ安装目录的oonf目录下的jetty-ream.properties文件进行修改
             *
             * borkerURL：访问ActiveMQ服务的路径地址。
             *  路径结构为：协议名://主机地址:端口号
             *  在conf/activemq.xml文件中可以找到修改
             *  在上一篇文章中都有介绍
             </span><span style="color: #008000;">*/</span><span style="color: #000000;">
            connectionFactory </span>= <span style="color: #0000ff;">new</span> ActiveMQConnectionFactory("admin", "admin", "tcp://169.254.18.20:61616"<span style="color: #000000;">);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建链接对象</span>
            connection =<span style="color: #000000;"> connectionFactory.createConnection();

            </span><span style="color: #008000;">//</span><span style="color: #008000;">启动连接</span>
<span style="color: #000000;">            connection.start();

            </span><span style="color: #008000;">/**</span><span style="color: #008000;">
             * 参数一：transacted 是否使用事务 可选值为:true|false
             *      ture:使用事务 设置第二个参数变量这为 Session.SESSION_TRANSACTION 交由session管理
             *      false:不使用事务，则设置我们的参数即可
             *
             * acknowledgeMode:
             * * Session.AUTO_ACKNOWLEDGE:自动消息确认机制
             * * Session.CLIENT_ACKNOWLEDGE:客户端确认机制
             * * Session.DUPS_OK_ACKNOWLEDGE:有副本的客户端确认消息机制
             这里设置 这两个参数的含义为：
             不使用事务，并由Session自动确认提交
             * 这里对此不作过多讲解，初学者跟着敲，其后在慢慢了解原理
             *
             </span><span style="color: #008000;">*/</span><span style="color: #000000;">
            session </span>= connection.createSession(<span style="color: #0000ff;">false</span><span style="color: #000000;">, Session.AUTO_ACKNOWLEDGE);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建目的地，目的地名称即队列的名称，也就是保存我们消息地方的名称。消息的消费者需要通过此名称访问对应的队列
            </span><span style="color: #008000;">//</span><span style="color: #008000;">名称不固定</span>
            destination = session.createQueue("hello-mq-obj"<span style="color: #000000;">);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建消息的生产者 需要指定目的地（也就是把Destination传入参数）</span>
            producer =<span style="color: #000000;"> session.createProducer(destination);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建消息对象 并传入我们需要放入队列的消息</span>
            message =<span style="color: #000000;"> session.createObjectMessage(user);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">发送消息</span>
<span style="color: #000000;">            producer.send(message);

        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
            e.printStackTrace();
        } </span><span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">回收消息发送者资源</span>
            <span style="color: #0000ff;">if</span> (producer != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    producer.close();
                } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JMSException e) {
                    e.printStackTrace();
                }
            }
            </span><span style="color: #0000ff;">if</span> (session != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    session.close();
                } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JMSException e) {
                    e.printStackTrace();
                }
            }
            </span><span style="color: #0000ff;">if</span> (connection != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    connection.close();
                } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JMSException e) {
                    e.printStackTrace();
                }
            }
        }
    }
}</span></code></pre>

<p>&nbsp;</p>
</blockquote>
<p>&nbsp;</p>
<h3>3 消息消费者</h3>
<blockquote>
<h3>3.1 还是需要pom的jar包依赖的的，如果还在原来的环境上，则不需要添加啦！</h3>
<src class="cnblogs_code">
<pre><code>&lt;dependency&gt;
            &lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;
            &lt;artifactId&gt;activemq-all&lt;/artifactId&gt;
            &lt;version&gt;5.9.0&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>

<p>&nbsp;</p>
<p><strong>3.2&nbsp; 编写消息的消费者</strong></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.arebirth.mq;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> cn.arebirth.pojo.User;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.activemq.ActiveMQConnectionFactory;

</span><span style="color: #0000ff;">import</span> javax.jms.*<span style="color: #000000;">;

</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ActiveMQObjectConsumer {
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> receiveObjectActiveMQ() {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义链接工厂</span>
        ConnectionFactory connectionFactory = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义链接对象</span>
        Connection connection = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义会话</span>
        Session session = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">目的地</span>
        Destination destination = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义消息的消费者（接收者）</span>
        MessageConsumer consumer = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义消息</span>
        Message message = <span style="color: #0000ff;">null</span><span style="color: #000000;">;


        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            </span><span style="color: #008000;">/**</span><span style="color: #008000;">
             * userName:访问ActiveMQ服务的用户名，默认为admin。
             * password：访问ActiveMQ服务的密码，默认为admin
             * 用户名和用户密码都可以通过ActiveMQ安装目录的oonf目录下的jetty-ream.properties文件进行修改
             *
             * borkerURL：访问ActiveMQ服务的路径地址。
             *  路径结构为：协议名://主机地址:端口号
             *  在conf/activemq.xml文件中可以找到修改
             *  在上一篇文章中都有介绍
             </span><span style="color: #008000;">*/</span><span style="color: #000000;">
            connectionFactory </span>= <span style="color: #0000ff;">new</span> ActiveMQConnectionFactory("admin", "admin", "tcp://169.254.18.20:61616"<span style="color: #000000;">);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建链接对象</span>
            connection =<span style="color: #000000;"> connectionFactory.createConnection();

            </span><span style="color: #008000;">//</span><span style="color: #008000;">启动连接</span>
<span style="color: #000000;">            connection.start();

            </span><span style="color: #008000;">/**</span><span style="color: #008000;">
             * 参数一：transacted 是否使用事务 可选值为:true|false
             *      ture:使用事务 设置第二个参数变量这为 Session.SESSION_TRANSACTION 交由session管理
             *      false:不使用事务，则设置我们的参数即可
             *
             * acknowledgeMode:
             * * Session.AUTO_ACKNOWLEDGE:自动消息确认机制
             * * Session.CLIENT_ACKNOWLEDGE:客户端确认机制
             * * Session.DUPS_OK_ACKNOWLEDGE:有副本的客户端确认消息机制
             这里设置 这两个参数的含义为：
             不使用事务，并由Session自动确认提交
             * 这里对此不作过多讲解，初学者跟着敲，其后在慢慢了解原理
             *
             </span><span style="color: #008000;">*/</span><span style="color: #000000;">
            session </span>= connection.createSession(<span style="color: #0000ff;">false</span><span style="color: #000000;">, Session.AUTO_ACKNOWLEDGE);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建目的地，目的地名称即队列的名称，也就是保存我们消息地方的名称。消息的消费者需要通过此名称访问对应的队列
            </span><span style="color: #008000;">//</span><span style="color: #008000;">名称不固定</span>
            destination = session.createQueue("hello-mq-obj"<span style="color: #000000;">);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建消息的消费者 需要指定目的地（也就是把Destination传入参数）</span>
            consumer =<span style="color: #000000;"> session.createConsumer(destination);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建消息对象 由消费者接收消息</span>
            message =<span style="color: #000000;"> consumer.receive();

            </span><span style="color: #008000;">//</span><span style="color: #008000;">处理消息</span>
            ObjectMessage objectMessage =<span style="color: #000000;"> (ObjectMessage) message;
            User user </span>=<span style="color: #000000;"> (User) objectMessage.getObject();
            System.out.println(</span>"ActiveMQ say:" +<span style="color: #000000;"> user);
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
            e.printStackTrace();
        } </span><span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">回收消息接收者资源</span>
            <span style="color: #0000ff;">if</span> (consumer != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    consumer.close();
                } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JMSException e) {
                    e.printStackTrace();
                }
            }
            </span><span style="color: #0000ff;">if</span> (session != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    session.close();
                } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JMSException e) {
                    e.printStackTrace();
                }
            }
            </span><span style="color: #0000ff;">if</span> (connection != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    connection.close();
                } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JMSException e) {
                    e.printStackTrace();
                }
            }
        }

    }
}</span></code></pre>

<p>&nbsp;</p>
</blockquote>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>4 创建测试类</h3>
<blockquote>
<p><strong>4.1 Produce生产者测试代码</strong></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.arebirth.mq;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> cn.arebirth.pojo.User;

</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ProducerTest {
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
        ActiveMQObjectProducer producer </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> ActiveMQObjectProducer();
        producer.sendObjectActiveMQ(</span><span style="color: #0000ff;">new</span> User("Arebirth","123","Hello,ActiveMQ!"<span style="color: #000000;">));
    }
}</span></code></pre>

<p>&nbsp;</p>
<p>当我们执行完这段代码后，我们打开我们的ActiveMQ的控制面板（首先你要启动你的ActiveMQ，上一篇有介绍到！）</p>
<p><img src="./images/ActiveMQ学习总结------原生实战操作（上）026.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;会看到 队列中增加了我们的消息！</p>
<p>&nbsp;</p>
<p><strong>4.2 Consumer消费者测试代码</strong></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.arebirth.mq;

</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ConsumerTest {
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
        ActiveMQObjectConsumer consumer </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> ActiveMQObjectConsumer();
        consumer.receiveObjectActiveMQ();
    }
}</span></code></pre>

<p>当我们执行后，出现下面的内容即可！成功啦！</p>
<p><img src="./images/ActiveMQ学习总结------原生实战操作（上）027.png" alt="" /></p>
<p>&nbsp;</p>
<p><strong>&nbsp;在看下，控制面板，</strong></p>
<p><img src="./images/ActiveMQ学习总结------原生实战操作（上）028.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong>是不是已经和上一个列子一样啦！</strong></p>
</blockquote>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong>ps</strong></p>
<p>　　本篇内容就到这里了，希望各位勤加敲代码，毕竟代码不是看出来的~</p>
<p>&nbsp;</p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>